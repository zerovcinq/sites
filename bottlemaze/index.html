<!DOCTYPE html>
<html style="height:100%">
    <head>
        <meta name="viewport" content="user-scalable=0">
        <style type="text/css">
            img {position:absolute;image-rendering:pixelated}
            button {position:absolute}
        </style>
    </head>
    <body style="width:100%;height:100%;overflow:hidden;background-color:#FFFFFF">
        <img src="frame.png" style="left:42%;top:11%;width:56%;height:78%">
        <img id="key" src="key.png" style="left:2%;top:17%;width:40%;height:48%">
        <img src="background.png" style="left:53%;top:24%;width:18%;height:1%">
        <img src="background.png" style="left:53%;top:25%;width:2%;height:3%">
        <img src="background.png" style="left:53%;top:30%;width:18%;height:1%">
        <img src="background.png" style="left:53%;top:31%;width:2%;height:3%">
        <img src="background.png" style="left:53%;top:36%;width:18%;height:1%">
        <img src="background.png" style="left:53%;top:37%;width:2%;height:3%">
        <img src="background.png" style="left:53%;top:42%;width:18%;height:1%">
        <img src="background.png" style="left:53%;top:43%;width:2%;height:3%">
        <img src="background.png" style="left:53%;top:48%;width:18%;height:1%">
        <img src="background.png" style="left:53%;top:49%;width:2%;height:3%">
        <img src="background.png" style="left:53%;top:54%;width:18%;height:1%">
        <img src="background.png" style="left:53%;top:55%;width:2%;height:3%">
        <img src="background.png" style="left:0%;top:0%;width:100%;height:11%">
        <img src="background.png" style="left:0%;top:89%;width:100%;height:11%">
        <img src="background.png" style="left:0%;top:11%;width:2%;height:78%">
        <img src="background.png" style="left:98%;top:11%;width:2%;height:78%">
        <img id="bottle0" src="bottle0.png" style="left:26%;top:20%;width:56%;height:6%">
        <img id="bottle1" src="bottle1.png" style="left:26%;top:26%;width:56%;height:6%">
        <img id="bottle2" src="bottle2.png" style="left:26%;top:32%;width:56%;height:6%">
        <img id="bottle3" src="bottle1.png" style="left:26%;top:38%;width:56%;height:6%">
        <img id="bottle4" src="bottle2.png" style="left:26%;top:44%;width:56%;height:6%">
        <img id="bottle5" src="bottle1.png" style="left:26%;top:50%;width:56%;height:6%">
        <button id="ball0" style="left:66%;top:23%;width:8%;height:3%;background-color:#7F7F7F" onclick="ball(0)">
        <button id="ball1" style="left:66%;top:29%;width:8%;height:3%;background-color:#7F7F7F" onclick="ball(1)">
        <button id="ball2" style="left:66%;top:35%;width:8%;height:3%;background-color:#7F7F7F" onclick="ball(2)">
        <button id="ball3" style="left:66%;top:41%;width:8%;height:3%;background-color:#7F7F7F" onclick="ball(3)">
        <button id="ball4" style="left:66%;top:47%;width:8%;height:3%;background-color:#7F7F7F" onclick="ball(4)">
        <button id="ball5" style="left:66%;top:53%;width:8%;height:3%;background-color:#7F7F7F" onclick="ball(5)">
        <button id="left" style="left:2%;top:17%;width:40%;height:3%" onclick="left()">
        <button id="right" style="left:2%;top:62%;width:40%;height:3%;visibility:hidden" onclick="right()">
        <button id="up0" style="left:74%;top:20%;width:8%;height:6%" onclick="up(0)">
        <button id="down0" style="left:26%;top:20%;width:8%;height:6%" onclick="down(0)">
        <button id="up1" style="left:74%;top:26%;width:8%;height:6%" onclick="up(1)">
        <button id="down1" style="left:26%;top:26%;width:8%;height:6%" onclick="down(1)">
        <button id="up2" style="left:74%;top:32%;width:8%;height:6%" onclick="up(2)">
        <button id="down2" style="left:26%;top:32%;width:8%;height:6%" onclick="down(2)">
        <button id="up3" style="left:74%;top:38%;width:8%;height:6%" onclick="up(3)">
        <button id="down3" style="left:26%;top:38%;width:8%;height:6%" onclick="down(3)">
        <button id="up4" style="left:74%;top:44%;width:8%;height:6%" onclick="up(4)">
        <button id="down4" style="left:26%;top:44%;width:8%;height:6%" onclick="down(4)">
        <button id="up5" style="left:74%;top:50%;width:8%;height:6%" onclick="up(5)">
        <button id="down5" style="left:26%;top:50%;width:8%;height:6%" onclick="down(5)">

        <script>
            var balls = [0, 0, 0, 0, 0, 0];
            var bottles = [1, 1, 1, 1, 1, 1];
            var key = 1;
            var steps = -1;
            refresh();

        function left(){
            key--;
            refresh();
        }
        function right(){
            key++;
            refresh();
        }

        function ball(iBall){
            if(balls[iBall] > 0 && bottles[iBall] == 2){
                balls[iBall] = 3 - balls[iBall];
                document.getElementById("ball" + iBall).style.top = balls[iBall] * 3 + iBall * 6 + 20 +"%";
                refresh();
            }
        }

        function refresh(){
            var a = key * 6 + 11 + "%";
            document.getElementById("key").style.top = key * 6 + 11 + "%";
            document.getElementById("left").style.top = key * 6 + 11 + "%";
            document.getElementById("right").style.top = key * 6 + 56 + "%";

            var locked = false;
            for(var i = 0; i < 6; i++){
                if(bottles[i] == 2){
                    locked = true;
                    break;
                }
            }
            if(locked){
                document.getElementById("right").style.visibility = "hidden";
                document.getElementById("left").style.visibility = "hidden";
            }else{
                document.getElementById("right").style.visibility = (key == 0 || bottles[key - 1] < 1 &&  key < 5) ? "visible" : "hidden";
                document.getElementById("left").style.visibility = key > 0 ? "visible" : "hidden";
            }

            for(var i = 0; i < 6; i++){
                document.getElementById("bottle" + i).style.left = (2 - bottles[i]) * 16 + 10 + "%";
                document.getElementById("up" + i).style.left = (2 - bottles[i]) * 16 + 58 + "%";
                document.getElementById("down" + i).style.left = (2 - bottles[i]) * 16 + 10 + "%";

                if(bottles[i] == 0){
                    document.getElementById("up" + i).style.visibility = "hidden";
                    document.getElementById("down" + i).style.visibility = (i == 0 || balls[i - 1] < 2) && key - i < 2 ? "visible" : "hidden";
                }else if(bottles[i] == 1){
                    document.getElementById("up" + i).style.visibility = (i == 0 || balls[i - 1] < 2) && balls[i] > 1 ? "visible" : "hidden";
                    document.getElementById("down" + i).style.visibility = key == i && (i == 0 || balls[i - 1] < 2) ? "visible" : "hidden";
                }else{
                    document.getElementById("up" + i).style.visibility = "visible";
                    document.getElementById("down" + i).style.visibility = "hidden";
                }
            }
            steps++;
            var passed = true;
            for(var i = 0; i < 6; i++){
                if(bottles[i] > 0){
                    passed = false
                    break;
                }
            }
            if(passed){
                alert("你用了" + steps + "步才解开，你啥也不是");
                window.location.reload();
            }
        }

        function up(iBottle){
            bottles[iBottle]--;
            if(balls[iBottle] < 2){
                balls[iBottle]--;
                document.getElementById("ball" + iBottle).style.left = (1 - balls[iBottle]) * 16 + 50 + "%";

            }
            refresh(iBottle);
        }

        function down(iBottle){
            bottles[iBottle]++;
            if(balls[iBottle] < 2){
                balls[iBottle]++;
                document.getElementById("ball" + iBottle).style.left = (1 - balls[iBottle]) * 16 + 50 + "%";
            }
            refresh(iBottle);
        }


        </script>
    </body>
</html>
